# Lameness Detection Platform â€” Architecture

## Table of contents
- [Overview](#overview)
- [Whatâ€™s new in the current architecture (2026)](#whats-new-in-the-current-architecture-2026)
- [System architecture diagram](#system-architecture-diagram)
- [Core components](#core-components)
- [Pipeline architecture](#pipeline-architecture)
- [Human-in-the-loop system](#human-in-the-loop-system)
- [Data flow](#data-flow)
- [Service catalog](#service-catalog)
- [Technology stack](#technology-stack)
- [Deployment](#deployment)

---

## Overview

The Lameness Detection Platform is a comprehensive multi-pipeline system for automated dairy cow lameness detection. It combines:

- **Computer Vision** (YOLO, SAM3, DINOv3)
- **Pose Estimation** (T-LEAP style)
- **Deep Learning** (TCN, Transformer, Graph Transformer)
- **Traditional ML** (XGBoost, CatBoost, LightGBM)
- **Human-in-the-Loop** (Pairwise/Triplet comparisons, Elo ranking)
- **Explainable AI** (SHAP, LLM explanations)

The platform processes uploaded videos into canonical clips, runs multiple CV/pose/graph/ML pipelines, and fuses all evidence into an explainable lameness prediction.

This document is meant to be **code-accurate** for this repository. For the step-by-step pipeline walkthrough (SAM3, DINOv3, Tâ€‘LEAP and how features feed ML), see `docs/PIPELINES_DETAILED.md`.

---

## Whatâ€™s new in the current architecture (2026)

### Cow identity (ID) and Cow Registry

- A dedicated **`tracking-service`** assigns persistent **cow IDs** across videos using:
  - within-video tracking (ByteTrack-style)
  - cross-video Re-ID using **DINOv3 embeddings + Qdrant vector search**
- The Admin UI includes a **Cow Registry** page (`/cows`) and a Cow Detail page (`/cows/:cowId`) backed by `admin-backend` endpoints under `/api/cows/*`.

### Graph-based predictors

- In addition to tabular ML and time-series models, the repo includes graph-based predictors:
  - `gnn-pipeline` (graph reasoning)
  - `graph-transformer-pipeline` (Graphormer-style)

### Canonical â€œsource of truthâ€ for data contracts

- NATS subjects and datastore URLs are defined in `shared/config/config.yaml`.
- Most pipelines both:
  - write a result file under `data/results/<pipeline>/...`
  - publish a NATS message referencing `results_path` and `features`.

---

## System Architecture Diagram

### Mermaid (recommended)

```mermaid
flowchart TB
  %% ======= Clients / UI =======
  subgraph UI[Admin UI]
    FE[admin-frontend<br/>React + TS]
    BE[admin-backend<br/>FastAPI]
  end

  %% ======= Infra =======
  subgraph Infra[Infrastructure]
    NATS[(NATS)]
    PG[(Postgres)]
    QD[(Qdrant)]
    FS[(Filesystem<br/>data/videos + data/processed + data/results)]
  end

  %% ======= Video lifecycle =======
  subgraph Video[Video lifecycle]
    ING[video-ingestion]
    PRE[video-preprocessing]
    CUR[clip-curation]
  end

  %% ======= Feature pipelines =======
  subgraph Feat[Feature extraction]
    YOLO[yolo-pipeline]
    SAM3[sam3-pipeline]
    DINO[dinov3-pipeline]
    TLEAP[tleap-pipeline]
  end

  %% ======= Identity =======
  subgraph ID[Identity / Tracking]
    TRACK[tracking-service<br/>ByteTrack + Re-ID]
  end

  %% ======= Predictors =======
  subgraph Pred[Predictors]
    ML[ml-pipeline]
    TCN[tcn-pipeline]
    TR[transformer-pipeline]
    GNN[gnn-pipeline]
    GT[graph-transformer-pipeline]
  end

  FUS[fusion-service]

  %% ======= UI wiring =======
  FE -->|HTTP| BE
  BE --> PG
  BE --> FS

  %% ======= Message bus =======
  ING -->|video.uploaded| NATS
  PRE -->|video.preprocessed| NATS
  CUR -->|video.curated| NATS

  %% ======= Feature extraction from preprocessed videos =======
  NATS --> YOLO
  NATS --> SAM3
  NATS --> DINO
  NATS --> TLEAP

  YOLO -->|pipeline.yolo| NATS
  SAM3 -->|pipeline.sam3| NATS
  DINO -->|pipeline.dinov3| NATS
  TLEAP -->|pipeline.tleap| NATS

  %% ======= Storage side effects =======
  PRE --> FS
  CUR --> FS
  YOLO --> FS
  SAM3 --> FS
  DINO --> FS
  DINO --> QD
  TLEAP --> FS

  %% ======= Tracking / cow registry =======
  NATS --> TRACK
  TRACK --> PG
  TRACK --> FS
  TRACK -->|tracking.complete| NATS

  %% ======= Predictors =======
  NATS --> ML
  NATS --> TCN
  NATS --> TR
  NATS --> GNN
  NATS --> GT

  ML -->|pipeline.ml| NATS
  TCN -->|pipeline.tcn| NATS
  TR -->|pipeline.transformer| NATS
  GNN -->|pipeline.gnn| NATS
  GT -->|pipeline.graph_transformer| NATS

  %% ======= Fusion =======
  NATS --> FUS
  FUS -->|pipeline.fusion| NATS
  FUS --> FS
  FUS -->|analysis.complete| NATS
```

### Detailed ASCII Diagram (updated)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FRONTEND INTERFACES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Data Upload  â”‚  â”‚  Pairwise    â”‚  â”‚   Triplet    â”‚  â”‚  Training Module     â”‚ â”‚
â”‚  â”‚              â”‚  â”‚  Comparison  â”‚  â”‚  Comparison  â”‚  â”‚  (Lameness Duolingo) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Hierarchy   â”‚  â”‚  Similarity  â”‚  â”‚   Results    â”‚  â”‚   Video Analysis     â”‚ â”‚
â”‚  â”‚  Viz (Elo)   â”‚  â”‚  Map (MDS)   â”‚  â”‚    Page      â”‚  â”‚   Dashboard          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BACKEND GATEWAY                                     â”‚
â”‚                         (FastAPI Admin Backend)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MESSAGE BUS (NATS)        â”‚    â”‚           DATA STORES                 â”‚
â”‚                                   â”‚    â”‚                                       â”‚
â”‚  Subjects:                        â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â€¢ video.uploaded                 â”‚    â”‚  â”‚ PostgreSQL  â”‚  â”‚    Qdrant      â”‚  â”‚
â”‚  â€¢ video.preprocessed             â”‚    â”‚  â”‚ (Users + Cow â”‚  â”‚  (Embeddings)  â”‚  â”‚
â”‚  â€¢ video.curated                  â”‚    â”‚  â”‚  Registry)  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â€¢ pipeline.{yolo,sam3,dinov3}    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚  â€¢ pipeline.{tleap,tcn,transformer}â”‚   â”‚                                       â”‚
â”‚  â€¢ pipeline.{gnn,graph_transformer,ml,fusion}                                   â”‚
â”‚  â€¢ tracking.{complete,reid.match} â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â€¢ hitl.comparison.submitted      â”‚    â”‚  â”‚     File System (Videos)        â”‚  â”‚
â”‚  â€¢ analysis.complete              â”‚    â”‚  â”‚  /data/videos, /data/processed  â”‚  â”‚
â”‚                                   â”‚    â”‚  â”‚  /data/results, /data/quality   â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PROCESSING PIPELINES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                        VIDEO PREPROCESSING LAYER                            â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚ Video Ingestion â”‚â”€â”€â”€â–¶â”‚  Preprocessing  â”‚â”€â”€â”€â–¶â”‚   Clip Curation         â”‚  â”‚â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚  (YOLO detect)  â”‚    â”‚   (5s canonical clips)  â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                       â”‚                                          â”‚
â”‚                                       â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    FEATURE EXTRACTION LAYER (PARALLEL)                      â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚     YOLO     â”‚  â”‚    SAM3      â”‚  â”‚   DINOv3     â”‚  â”‚   T-LEAP     â”‚    â”‚â”‚
â”‚  â”‚  â”‚  Detection   â”‚  â”‚ Segmentation â”‚  â”‚  Embeddings  â”‚  â”‚    Pose      â”‚    â”‚â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚    â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Bounding   â”‚  â”‚ â€¢ Silhouette â”‚  â”‚ â€¢ 768-dim    â”‚  â”‚ â€¢ Keypoints  â”‚    â”‚â”‚
â”‚  â”‚  â”‚   boxes      â”‚  â”‚   masks      â”‚  â”‚   vectors    â”‚  â”‚ â€¢ Locomotion â”‚    â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Confidence â”‚  â”‚ â€¢ Area/shape â”‚  â”‚ â€¢ Similarity â”‚  â”‚   features   â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                       â”‚                                          â”‚
â”‚                                       â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         IDENTITY / TRACKING                                 â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚â”‚
â”‚  â”‚  â”‚        tracking-service      â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚  â€¢ within-video tracking     â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚  â€¢ cross-video Re-ID (QD)    â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚  â€¢ writes Cow Registry (PG)  â”‚                                           â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                       â”‚                                          â”‚
â”‚                                       â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      DEEP LEARNING LAYER (PARALLEL)                         â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚         TCN        â”‚  â”‚    Transformer     â”‚  â”‚   Graph Pipelines  â”‚    â”‚â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                    â”‚  â”‚ (GNN + Graphormer) â”‚    â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Dilated Conv1D   â”‚  â”‚ â€¢ Self-attention   â”‚  â”‚ â€¢ similarity graph â”‚    â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Temporal patternsâ”‚  â”‚ â€¢ Positional enc   â”‚  â”‚ â€¢ neighbor context â”‚    â”‚â”‚
â”‚  â”‚  â”‚ â€¢ MC Dropout       â”‚  â”‚ â€¢ Saliency output  â”‚  â”‚ â€¢ uncertainty      â”‚    â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Uncertainty est  â”‚  â”‚ â€¢ Masking for gaps â”‚  â”‚                    â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                       â”‚                                          â”‚
â”‚                                       â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         ML ENSEMBLE LAYER                                   â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚â”‚
â”‚  â”‚  â”‚   XGBoost    â”‚  â”‚   CatBoost   â”‚  â”‚   LightGBM   â”‚                      â”‚â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚                      â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HUMAN-IN-THE-LOOP LAYER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Pairwise Review  â”‚  â”‚ Triplet Compare  â”‚  â”‚    Rater Reliability         â”‚   â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚ â€¢ 7-point scale  â”‚  â”‚ â€¢ Reference-basedâ”‚  â”‚ â€¢ Dawid-Skene algorithm      â”‚   â”‚
â”‚  â”‚ â€¢ Tutorial mode  â”‚  â”‚ â€¢ Similarity/    â”‚  â”‚ â€¢ GLAD model                 â”‚   â”‚
â”‚  â”‚ â€¢ Elo ranking    â”‚  â”‚   dissimilarity  â”‚  â”‚ â€¢ Gold task injection        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ Bronze/Silver/Gold tiers   â”‚   â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FUSION & EXPLANATION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         FUSION SERVICE                                      â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  Inputs:                          Fusion Strategy:                          â”‚â”‚
â”‚  â”‚  â€¢ ML ensemble (25%)              â€¢ Rule-based gating                       â”‚â”‚
â”‚  â”‚  â€¢ TCN (15%)                      â€¢ Stacking meta-model                     â”‚â”‚
â”‚  â”‚  â€¢ Transformer (15%)              â€¢ Confidence calibration                  â”‚â”‚
â”‚  â”‚  â€¢ GNN (15%)                      â€¢ Agreement tracking                      â”‚â”‚
â”‚  â”‚  â€¢ Human consensus (30%)                                                    â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  Output: final_probability, confidence, recommendation                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                       â”‚                                          â”‚
â”‚                                       â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚      SHAP Service        â”‚  â”‚      LLM Service         â”‚                     â”‚
â”‚  â”‚                          â”‚  â”‚                          â”‚                     â”‚
â”‚  â”‚ â€¢ Local explanations     â”‚  â”‚ â€¢ Evidence-based summary â”‚                     â”‚
â”‚  â”‚ â€¢ Feature importance     â”‚  â”‚ â€¢ Key indicators         â”‚                     â”‚
â”‚  â”‚ â€¢ Force plots            â”‚  â”‚ â€¢ Action recommendations â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Core Components

### 1. Video Processing

| Component | Purpose | Key Features |
|-----------|---------|--------------|
| **Video Ingestion** | Accept uploads | Format validation, metadata extraction |
| **Video Preprocessing** | Detect & crop cow | YOLO detection, bounding box tracking |
| **Clip Curation** | Extract optimal 5s | Quality scoring, direction normalization |

### 2. Feature Extraction Pipelines

| Pipeline | Model | Output Features |
|----------|-------|-----------------|
| **YOLO** | YOLOv8n | Bounding boxes, detection confidence, position stability |
| **SAM3** | Segment Anything 3 | Silhouette masks, area ratio, circularity, aspect ratio |
| **DINOv3** | DINOv2-base | 768-dim embeddings, kNN similarity |
| **T-LEAP** | YOLOv8-Pose | 20 keypoints, back arch, head bob, leg asymmetry |

### 3. Deep Learning Pipelines

| Pipeline | Architecture | Specialty |
|----------|--------------|-----------|
| **TCN** | Temporal Convolutional Network | Dilated causal convolutions, large receptive field |
| **Transformer** | Encoder-only Transformer | Self-attention, positional encoding, saliency maps |
| **GraphGPS** | Graph Transformer | kNN edges, Laplacian PE, local + global attention |

### 4. ML Ensemble

| Model | Type | Strengths |
|-------|------|-----------|
| **XGBoost** | Gradient Boosting | Speed, regularization |
| **CatBoost** | Gradient Boosting | Categorical features, less overfitting |
| **LightGBM** | Gradient Boosting | Memory efficient, large datasets |

---

## Pipeline Architecture

### Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VIDEO UPLOAD                              â”‚
â”‚                        (30s raw video)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CLIP CURATION                               â”‚
â”‚                                                                   â”‚
â”‚  1. Track cow through video (centroid tracking)                   â”‚
â”‚  2. Identify walking passes (direction changes)                   â”‚
â”‚  3. Score 5s windows:                                            â”‚
â”‚     â€¢ Framing score (25%) - bbox size, edge proximity            â”‚
â”‚     â€¢ Steadiness score (25%) - speed consistency                 â”‚
â”‚     â€¢ Straightness score (15%) - vertical deviation              â”‚
â”‚     â€¢ Visual quality (15%) - blur, brightness                    â”‚
â”‚     â€¢ Occlusion score (10%) - detection confidence               â”‚
â”‚     â€¢ Progress penalty (10%) - mid-pass preferred                â”‚
â”‚  4. Normalize direction (flip to leftâ†’right)                     â”‚
â”‚  5. Export canonical_5s_clip.mp4 + quality_report.json           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    â”‚                    â”‚
          â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   YOLO + SAM3   â”‚  â”‚     DINOv3      â”‚  â”‚     T-LEAP      â”‚
â”‚   (Visual)      â”‚  â”‚  (Embeddings)   â”‚  â”‚     (Pose)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚                   â”‚
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       TCN       â”‚  â”‚   Transformer   â”‚  â”‚     GraphGPS    â”‚
â”‚  (Time-series)  â”‚  â”‚  (Time-series)  â”‚  â”‚    (Relational) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ML ENSEMBLE                                â”‚
â”‚              XGBoost + CatBoost + LightGBM                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FUSION SERVICE                               â”‚
â”‚                                                                   â”‚
â”‚  Inputs weighted by confidence:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    ML      â”‚    TCN     â”‚ Transformerâ”‚    GNN     â”‚ Human  â”‚ â”‚
â”‚  â”‚   (25%)    â”‚   (15%)    â”‚   (15%)    â”‚   (15%)    â”‚ (30%)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Decision modes:                                                  â”‚
â”‚  â€¢ "human" - High human confidence + sufficient raters           â”‚
â”‚  â€¢ "automated" - Strong model agreement + high confidence        â”‚
â”‚  â€¢ "hybrid" - Combine all sources                                â”‚
â”‚  â€¢ "uncertain" - Request more labels                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FINAL OUTPUT                                  â”‚
â”‚                                                                   â”‚
â”‚  {                                                                â”‚
â”‚    "final_probability": 0.73,                                     â”‚
â”‚    "final_prediction": 1,  // Lame                               â”‚
â”‚    "confidence": 0.82,                                           â”‚
â”‚    "decision_mode": "hybrid",                                    â”‚
â”‚    "recommendation": "Consider veterinary examination",          â”‚
â”‚    "pipeline_contributions": {...},                              â”‚
â”‚    "shap_explanation": {...},                                    â”‚
â”‚    "llm_summary": "This cow shows signs of lameness..."          â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Human-in-the-Loop System

### Comparison Types

#### Pairwise Comparison (7-Point Scale)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PAIRWISE COMPARISON                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Video A    â”‚     VS       â”‚   Video B    â”‚                 â”‚
â”‚  â”‚              â”‚              â”‚              â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                  â”‚
â”‚  Scale:                                                          â”‚
â”‚  [-3] A Much More Lame                                          â”‚
â”‚  [-2] A More Lame                                               â”‚
â”‚  [-1] A Slightly More Lame                                      â”‚
â”‚  [ 0] Equal / Cannot Decide                                     â”‚
â”‚  [+1] B Slightly More Lame                                      â”‚
â”‚  [+2] B More Lame                                               â”‚
â”‚  [+3] B Much More Lame                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Triplet Comparison
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TRIPLET COMPARISON                           â”‚
â”‚                                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                    â”‚  Reference   â”‚                             â”‚
â”‚                    â”‚              â”‚                             â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                           â”‚                                      â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚            â–¼                              â–¼                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚ Comparison A â”‚              â”‚ Comparison B â”‚              â”‚
â”‚     â”‚              â”‚              â”‚              â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  Question: "Which walks MORE SIMILARLY to the reference?"        â”‚
â”‚           or "Which walks MORE DIFFERENTLY from the reference?"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rater Reliability System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RATER RELIABILITY                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              DAWID-SKENE ALGORITHM                          â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Simultaneously infers:                                     â”‚â”‚
â”‚  â”‚  â€¢ True labels for items                                    â”‚â”‚
â”‚  â”‚  â€¢ Confusion matrices for each rater                        â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  E-step: Estimate posterior over true labels                â”‚â”‚
â”‚  â”‚  M-step: Update class priors and rater error rates          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    RATER TIERS                              â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  ğŸ¥‰ Bronze: Gold accuracy < 70%   â†’ Weight: 0.5x            â”‚â”‚
â”‚  â”‚  ğŸ¥ˆ Silver: Gold accuracy 70-85%  â†’ Weight: 1.0x            â”‚â”‚
â”‚  â”‚  ğŸ¥‡ Gold:   Gold accuracy > 85%   â†’ Weight: 1.5x            â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Tier determines:                                           â”‚â”‚
â”‚  â”‚  â€¢ Vote weight in consensus                                 â”‚â”‚
â”‚  â”‚  â€¢ Access to real labeling tasks                            â”‚â”‚
â”‚  â”‚  â€¢ Leaderboard position                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              GOLD TASK INJECTION                            â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  â€¢ 10% of tasks are pre-labeled by experts                  â”‚â”‚
â”‚  â”‚  â€¢ Used to validate rater accuracy                          â”‚â”‚
â”‚  â”‚  â€¢ Raters don't know which tasks are gold                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

### NATS Message Subjects

Source of truth: `shared/config/config.yaml`

| Subject | Publisher | Subscribers | Notes |
|---------|-----------|-------------|------|
| `video.uploaded` | video-ingestion | video-preprocessing, clip-curation | new raw upload |
| `video.preprocessed` | video-preprocessing | yolo/sam3/dinov3/tleap/etc | processed video path available |
| `video.curated` | clip-curation | (optional) downstream consumers | canonical clip ready |
| `pipeline.yolo` | yolo-pipeline | tracking-service, (others) | bbox detections + aggregate features |
| `pipeline.sam3` | sam3-pipeline | ml-pipeline | segmentation-derived features |
| `pipeline.dinov3` | dinov3-pipeline | tracking-service, gnn/graph-transformer | embeddings + similar_cases + neighbor_evidence |
| `pipeline.tleap` | tleap-pipeline | tcn/transformer/ml | pose sequences + locomotion features |
| `pipeline.tcn` | tcn-pipeline | fusion-service | time-series score |
| `pipeline.transformer` | transformer-pipeline | fusion-service | time-series score + attention info |
| `pipeline.gnn` | gnn-pipeline | fusion-service | graph-based score |
| `pipeline.graph_transformer` | graph-transformer-pipeline | fusion-service | graph transformer score + uncertainty |
| `pipeline.ml` | ml-pipeline | fusion-service | tabular ensemble prediction |
| `tracking.complete` | tracking-service | (optional) consumers | track assignment written + summary published |
| `tracking.reid.match` | tracking-service | (optional) consumers | re-id match events |
| `tracking.lameness.update` | tracking-service | (optional) consumers | cow-level lameness DB update event |
| `pipeline.fusion` | fusion-service | admin-backend (via files), shap/llm | final probability + confidence |
| `analysis.complete` | fusion-service | llm-service | high-level â€œanalysis doneâ€ hook |

---

## Service Catalog

### Infrastructure Services

| Service | Port | Description |
|---------|------|-------------|
| **NATS** | 4222 | Message broker for inter-service communication |
| **PostgreSQL** | 5432 | Metadata storage (videos, labels, comparisons) |
| **Qdrant** | 6333 | Vector database for DINOv3 embeddings |

### Application Services

| Service | Description | Input | Output |
|---------|-------------|-------|--------|
| **video-ingestion** | Accepts video uploads | Raw video file | `video.uploaded` event |
| **video-preprocessing** | Detects and crops cow | Raw video | Cropped video |
| **clip-curation** | Extracts optimal 5s clip | 30s video | Canonical clip + quality report |
| **yolo-pipeline** | Object detection | Video frames | Bounding boxes, confidence |
| **sam3-pipeline** | Segmentation | Video frames | Silhouette masks |
| **dinov3-pipeline** | Feature embeddings | Video frames | 768-dim vectors |
| **tleap-pipeline** | Pose estimation | Video frames | Keypoints, locomotion metrics |
| **tcn-pipeline** | Temporal analysis | Pose sequence | Severity score, uncertainty |
| **transformer-pipeline** | Temporal analysis | Pose sequence | Severity score, saliency |
| **gnn-pipeline** | Graph reasoning | All features | Score, neighbor context |
| **graph-transformer-pipeline** | Graph transformer reasoning | All features | Score, uncertainty, attention info |
| **tracking-service** | Tracking + cross-video cow Re-ID | YOLO + DINOv3 | Cow IDs + per-video track history |
| **ml-pipeline** | Tabular ML | All features | Ensemble prediction |
| **fusion-service** | Prediction fusion | All predictions | Final probability |
| **rater-reliability** | Rater modeling | Comparisons | Rater weights, consensus |
| **shap-service** | Explainability | Features, prediction | SHAP values |
| **llm-service** | Natural language | All evidence | Human-readable summary |
| **admin-backend** | REST API | HTTP requests | JSON responses |
| **admin-frontend** | Web UI | User actions | React components |

---

## Technology Stack

### Backend
- **Python 3.10** - Core language
- **FastAPI** - REST API framework
- **NATS** - Message broker
- **PyTorch** - Deep learning (TCN, Transformer, GraphGPS)
- **PyTorch Geometric** - Graph neural networks
- **Ultralytics** - YOLO models
- **scikit-learn** - ML utilities
- **XGBoost/CatBoost/LightGBM** - Gradient boosting
- **OpenCV** - Video processing
- **SHAP** - Explainability

### Frontend
- **React 18** - UI framework
- **TypeScript** - Type safety
- **Tailwind CSS** - Styling
- **Vite** - Build tool
- **Axios** - HTTP client

### Infrastructure
- **Docker** - Containerization
- **Docker Compose** - Orchestration
- **PostgreSQL** - Relational database
- **Qdrant** - Vector database
- **NATS** - Message queue

---

## Deployment

### Docker Compose Services (22 total)

```yaml
services:
  # Infrastructure
  - nats
  - postgres
  - qdrant
  
  # Video Processing
  - video-ingestion
  - video-preprocessing
  - clip-curation
  
  # Feature Extraction
  - yolo-pipeline
  - sam3-pipeline
  - dinov3-pipeline
  - tleap-pipeline
  
  # Deep Learning
  - tcn-pipeline
  - transformer-pipeline
  - gnn-pipeline
  
  # ML & Fusion
  - ml-pipeline
  - fusion-service
  
  # Human-in-the-Loop
  - rater-reliability
  
  # Explainability
  - shap-service
  - llm-service
  
  # Admin Interface
  - admin-backend
  - admin-frontend
  
  # Utilities
  - annotation-renderer
  - training-service
```

### Environment Variables

```bash
# NATS
NATS_URL=nats://nats:4222

# PostgreSQL
POSTGRES_URL=postgresql://user:pass@postgres:5432/lameness_db

# Qdrant
QDRANT_URL=http://qdrant:6333

# LLM (optional)
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o-mini
```

### Quick Start

```bash
# Clone repository
git clone <repository-url>
cd vision-sam3-yolo-lameless

# Start all services
docker-compose up -d

# Run tests
python test_setup.py
python test_docker.py

# Access interfaces
# Frontend: http://localhost:3000
# Backend API: http://localhost:8000
# API Docs: http://localhost:8000/docs
```

---

## Appendix: Mermaid Diagram

For tools that support Mermaid rendering:

```mermaid
flowchart TB
    subgraph frontend [Frontend Interfaces]
        Upload[Data Upload]
        VideoProc[Video Processing UI]
        Pairwise[Pairwise Comparison]
        Triplet[Triplet Comparison]
        Viz[Visualization Dashboard]
        Training[Training Module]
    end
    
    subgraph backend [Backend Pipelines]
        Curation[Clip Curation]
        YOLO[YOLO Detection]
        SAM3[SAM3 Segmentation]
        DINO[DINOv3 Embeddings]
        TLEAP[T-LEAP Pose]
        TCN[TCN Pipeline]
        Transformer[Transformer Pipeline]
        GraphT[Graph Transformer]
        ML[Tabular ML]
        Fusion[Ensemble Fusion]
    end
    
    subgraph hitl [Human-in-the-Loop]
        Consensus[Human Consensus]
        RaterRel[Rater Reliability]
        ActiveLearn[Active Learning]
    end
    
    Upload --> Curation
    Curation --> YOLO & SAM3 & DINO & TLEAP
    TLEAP --> TCN & Transformer
    DINO --> GraphT
    YOLO & SAM3 & DINO & TLEAP & TCN & Transformer & GraphT & ML --> Fusion
    Consensus --> Fusion
    Fusion --> Viz
    ActiveLearn --> Pairwise & Triplet
```

---

*Document Version: 2.0*  
*Last Updated: 2026-01-03*

